#!/usr/bin/env node

/**
 * merged-restaurants.jsonì—ì„œ reservation ë°ì´í„°ë§Œ ì¶”ì¶œí•˜ì—¬
 * data.jsì— ì‚½ì…í•  JavaScript ì½”ë“œ ìƒì„±
 *
 * ì‚¬ìš©ë²•:
 *   node scripts/generate-reservation-data.cjs
 *
 * ì¶œë ¥:
 *   - docs/reservation-data.js (data.jsì— ë³µì‚¬í•  ì½”ë“œ)
 */

const fs = require('fs');
const path = require('path');

const MERGED_PATH = path.join(__dirname, '../docs/merged-restaurants.json');
const OUTPUT_PATH = path.join(__dirname, '../docs/reservation-data.js');

function main() {
  console.log('ğŸš€ Generating reservation data JavaScript...\n');

  // 1. Load merged data
  console.log('ğŸ“‚ Loading merged-restaurants.json...');
  const merged = JSON.parse(fs.readFileSync(MERGED_PATH, 'utf-8'));
  console.log(`âœ… Loaded ${merged.length} restaurants\n`);

  // 2. Extract reservation data
  console.log('ğŸ”„ Extracting reservation data...');
  const reservationMap = {};

  let count = 0;
  merged.forEach(restaurant => {
    if (restaurant.reservation) {
      // ì´ë¦„ì„ í‚¤ë¡œ ì‚¬ìš©
      reservationMap[restaurant.name] = restaurant.reservation;
      count++;
    }
  });

  console.log(`âœ… Extracted ${count} restaurants with reservation data\n`);

  // 3. Generate JavaScript code
  console.log('ğŸ“ Generating JavaScript code...');

  const jsCode = `// ========================================
// Restaurant Reservation Data
// ========================================
//
// Auto-generated by: scripts/generate-reservation-data.cjs
// Source: docs/merged-restaurants.json
//
// Usage in data.js:
//   1. Copy this entire object
//   2. Add to data.js as: const restaurantReservations = { ... };
//   3. In allRestaurants.map(), add:
//      reservation: restaurantReservations[name] || null
//
// ========================================

const restaurantReservations = ${JSON.stringify(reservationMap, null, 2)};

// Export for Node.js (if needed)
if (typeof module !== 'undefined' && module.exports) {
  module.exports = restaurantReservations;
}
`;

  // 4. Save to file
  fs.writeFileSync(OUTPUT_PATH, jsCode, 'utf-8');
  console.log(`âœ… Saved to: ${OUTPUT_PATH}\n`);

  // 5. Print instructions
  console.log('ğŸ“‹ Next Steps:\n');
  console.log('1. Open docs/reservation-data.js');
  console.log('2. Copy the "const restaurantReservations = { ... };" object');
  console.log('3. Paste it in data.js BEFORE the allRestaurants parsing');
  console.log('4. Update allRestaurants.map() to include:');
  console.log('     reservation: restaurantReservations[name] || null');
  console.log('\nâœ¨ Done!\n');
}

main();
